<!DOCTYPE html>
<html>
<head>
    <title>Fix Projects Data</title>
</head>
<body>
    <h1>Project Data Diagnostics</h1>
    <div id="output"></div>
    
    <script>
        // Load current projects from localStorage
        const stored = localStorage.getItem('saxtech_projects');
        const output = document.getElementById('output');
        
        if (stored) {
            const projects = JSON.parse(stored);
            output.innerHTML = '<h2>Current Projects in localStorage:</h2>';
            output.innerHTML += '<pre>' + JSON.stringify(projects, null, 2) + '</pre>';
            
            // Remove duplicate N8N Workflow project
            const filteredProjects = projects.filter(p => {
                // Remove projects that are just N8N workflow imports
                if (p.client === 'N8N Workflow' || p.client === 'SAXTech Automation') {
                    console.log('Removing duplicate workflow project:', p.name);
                    return false;
                }
                return true;
            });
            
            // Ensure all projects have proper structure for workflow preview
            filteredProjects.forEach(p => {
                // If project has n8n workflows, ensure structure is correct
                if (p.n8nWorkflows && !p.n8nWorkflows.main && p.n8nWorkflows.length > 0) {
                    // Old format - convert to new format
                    p.n8nWorkflows = {
                        main: p.n8nWorkflows[0],
                        additional: p.n8nWorkflows.slice(1)
                    };
                }
            });
            
            // Save cleaned projects
            localStorage.setItem('saxtech_projects', JSON.stringify(filteredProjects));
            
            output.innerHTML += '<h2>Cleaned Projects (saved):</h2>';
            output.innerHTML += '<pre>' + JSON.stringify(filteredProjects, null, 2) + '</pre>';
            
            output.innerHTML += '<h3>Actions taken:</h3>';
            output.innerHTML += '<ul>';
            output.innerHTML += '<li>Removed ' + (projects.length - filteredProjects.length) + ' duplicate workflow projects</li>';
            output.innerHTML += '<li>Fixed n8nWorkflows structure for preview button</li>';
            output.innerHTML += '</ul>';
            
            output.innerHTML += '<p><strong>Now refresh the main page to see the changes!</strong></p>';
        } else {
            output.innerHTML = '<p>No projects found in localStorage</p>';
            
            // Initialize with empty array
            localStorage.setItem('saxtech_projects', JSON.stringify([]));
            output.innerHTML += '<p>Initialized empty projects array</p>';
        }
    </script>
</body>
</html>
